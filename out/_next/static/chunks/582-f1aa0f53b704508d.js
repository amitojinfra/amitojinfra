(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[582],{1802:function(e,t,a){"use strict";a.d(t,{GA:function(){return o},OF:function(){return i},Qi:function(){return m},SX:function(){return r},h$:function(){return n},sy:function(){return l}});let n={CASH:"Cash",ONLINE:"Online"};Object.values(n);let o=e=>{let t={},a=!0;if(e.employee_id&&""!==e.employee_id.trim()||(t.employee_id="Employee is required",a=!1),e.amount&&""!==e.amount){let n=parseFloat(e.amount);isNaN(n)||n<=0?(t.amount="Payment amount must be greater than 0",a=!1):n>1e6&&(t.amount="Payment amount cannot exceed 10,00,000",a=!1)}else t.amount="Payment amount is required",a=!1;if(e.payment_date){let n=new Date(e.payment_date),o=new Date,r=new Date("2020-01-01");isNaN(n.getTime())?(t.payment_date="Invalid payment date",a=!1):n>o?(t.payment_date="Payment date cannot be in the future",a=!1):n<r&&(t.payment_date="Payment date cannot be before 2020",a=!1)}else t.payment_date="Payment date is required",a=!1;return e.payment_mode&&""!==e.payment_mode.trim()?Object.values(n).includes(e.payment_mode)||(t.payment_mode="Please select a valid payment mode",a=!1):(t.payment_mode="Payment mode is required",a=!1),e.paid_by&&""!==e.paid_by.trim()?e.paid_by.trim().length<2?(t.paid_by="Paid by name must be at least 2 characters long",a=!1):e.paid_by.trim().length>100&&(t.paid_by="Paid by name must not exceed 100 characters",a=!1):(t.paid_by="Paid by name is required",a=!1),e.notes&&e.notes.trim().length>500&&(t.notes="Notes must not exceed 500 characters",a=!1),{isValid:a,errors:t}},r=e=>{var t,a,n;let o={employee_id:(null===(t=e.employee_id)||void 0===t?void 0:t.trim())||"",amount:parseFloat(e.amount)||0,payment_date:e.payment_date||null,payment_mode:(null===(a=e.payment_mode)||void 0===a?void 0:a.trim())||"",paid_by:(null===(n=e.paid_by)||void 0===n?void 0:n.trim())||"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return e.notes&&""!==e.notes.trim()&&(o.notes=e.notes.trim()),o},i=e=>{let t=[];if(e.employee_id&&t.push(e.employee_id.toLowerCase()),e.paid_by){t.push(e.paid_by.toLowerCase());let a=e.paid_by.toLowerCase().split(" ");t.push(...a)}if(e.payment_mode&&t.push(e.payment_mode.toLowerCase()),e.payment_date){let a=new Date(e.payment_date);t.push(a.getFullYear().toString()),t.push(a.toLocaleDateString("en-IN",{month:"long"}).toLowerCase())}if(e.notes){let a=e.notes.toLowerCase().split(" ");t.push(...a)}return[...new Set(t)]},l=()=>({employee_id:"",amount:"",payment_date:new Date().toISOString().split("T")[0],payment_mode:"",paid_by:"",notes:""}),m=e=>Array.isArray(e)&&0!==e.length?e.reduce((e,t)=>e+(parseFloat(t.amount)||0),0):0},5430:function(e,t,a){"use strict";var n=a(5799),o=a(8804),r=a(1802);class i{async createPayment(e){try{let t=(0,r.GA)(e);if(!t.isValid)throw Error("Validation failed: ".concat(Object.values(t.errors).join(", ")));if(!await o.Z.getEmployee(e.employee_id))throw Error("Employee not found");let a=(0,r.SX)(e);return a.search_keywords=(0,r.OF)(a),{id:(await n.Z.addDocument(this.collectionName,a)).id,...a}}catch(e){throw console.error("Error creating payment:",e),e}}async getPaymentById(e){try{return await n.Z.getDocument(this.collectionName,e)}catch(e){throw console.error("Error getting payment by ID:",e),e}}async getAllPayments(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=await n.Z.getDocuments(this.collectionName);if(e.employee_id&&(t=t.filter(t=>t.employee_id===e.employee_id)),e.dateRange){let{start:a,end:n}=e.dateRange;t=t.filter(e=>{let t=new Date(e.payment_date),o=new Date(a),r=new Date(n);return t>=o&&t<=r})}return e.payment_mode&&(t=t.filter(t=>t.payment_mode===e.payment_mode)),e.paid_by&&(t=t.filter(t=>t.paid_by&&t.paid_by.toLowerCase().includes(e.paid_by.toLowerCase()))),t.sort((e,t)=>new Date(t.payment_date)-new Date(e.payment_date)),e.limit&&(t=t.slice(0,e.limit)),t}catch(e){throw console.error("Error getting all payments:",e),e}}async getEmployeePayments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await this.getAllPayments({...t,employee_id:e})}catch(e){throw console.error("Error getting employee payments:",e),e}}async getPaymentsByDateRange(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{return await this.getAllPayments({...a,dateRange:{start:e,end:t}})}catch(e){throw console.error("Error getting payments by date range:",e),e}}async updatePayment(e,t){try{let a=(0,r.GA)(t);if(!a.isValid)throw Error("Validation failed: ".concat(Object.values(a.errors).join(", ")));if(!await this.getPaymentById(e))throw Error("Payment record not found");if(!await o.Z.getEmployee(t.employee_id))throw Error("Employee not found");let i=(0,r.SX)(t);return i.updated_at=new Date().toISOString(),i.search_keywords=(0,r.OF)(i),await n.Z.updateDocument(this.collectionName,e,i),{id:e,...i}}catch(e){throw console.error("Error updating payment:",e),e}}async deletePayment(e){try{if(!await this.getPaymentById(e))return console.warn("Payment record ".concat(e," not found in database")),!1;return await n.Z.deleteDocument(this.collectionName,e),console.log("Successfully deleted payment record: ".concat(e)),!0}catch(e){throw console.error("Error deleting payment:",e),e}}async getPaymentStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=await this.getAllPayments(e),a={total_payments:t.length,total_amount:(0,r.Qi)(t),cash_payments:t.filter(e=>"Cash"===e.payment_mode).length,online_payments:t.filter(e=>"Online"===e.payment_mode).length,cash_amount:(0,r.Qi)(t.filter(e=>"Cash"===e.payment_mode)),online_amount:(0,r.Qi)(t.filter(e=>"Online"===e.payment_mode)),unique_employees:[...new Set(t.map(e=>e.employee_id))].length,date_range:null};if(t.length>0){let e=t.map(e=>new Date(e.payment_date)).sort((e,t)=>e-t);a.date_range={start:e[0].toISOString().split("T")[0],end:e[e.length-1].toISOString().split("T")[0]}}return a}catch(e){throw console.error("Error getting payment stats:",e),e}}async searchPayments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!e||""===e.trim())return await this.getAllPayments(t);let a=e.toLowerCase().trim();return(await this.getAllPayments(t)).filter(e=>(e.search_keywords||[]).some(e=>e.includes(a))||e.employee_id.toLowerCase().includes(a)||e.paid_by&&e.paid_by.toLowerCase().includes(a)||e.notes&&e.notes.toLowerCase().includes(a))}catch(e){throw console.error("Error searching payments:",e),e}}async getPaymentSummaryByEmployee(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=await this.getAllPayments(e),a={};for(let e of t){if(!a[e.employee_id])try{let t=await o.Z.getEmployee(e.employee_id);a[e.employee_id]={employee_id:e.employee_id,employee_name:t?t.name:"Unknown Employee",employee_designation:t?t.designation:"N/A",total_amount:0,payment_count:0,last_payment_date:null,payments:[]}}catch(t){a[e.employee_id]={employee_id:e.employee_id,employee_name:"Unknown Employee",employee_designation:"N/A",total_amount:0,payment_count:0,last_payment_date:null,payments:[]}}let t=parseFloat(e.amount)||0;a[e.employee_id].total_amount+=t,a[e.employee_id].payment_count+=1,a[e.employee_id].payments.push(e);let n=new Date(e.payment_date),r=a[e.employee_id].last_payment_date;(!r||n>new Date(r))&&(a[e.employee_id].last_payment_date=e.payment_date)}return Object.values(a).sort((e,t)=>t.total_amount-e.total_amount)}catch(e){throw console.error("Error getting payment summary by employee:",e),e}}constructor(){this.collectionName="payments"}}let l=new i;t.Z=l},1163:function(e,t,a){e.exports=a(3079)}}]);